<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <!-- Use title if it's in the page YAML frontmatter -->
        <title>Rails Controllers</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="/css/app/application.css">
        <script src="js/vendor/modernizr-2.6.1.min.js"></script>
        <script type="text/javascript" src="//use.typekit.net/cay8udd.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->
        <div class="page-container">
            <header class="page-header" >
                <h1><a href="/">Stationkeeping</a></h1>

            </header>
            <div class="page-body">
                <div class="primary">
                    <p>Much of <code>ActionController</code> is implemented in Rack, as a series of filters. Other gems like <em>Warden</em> and <em>BetterErrors</em> are also written as Rack filters. Sometimes these filters are a way of tying gem functionality into Rack rather than the functionality existing entirely within Rack.</p>

<p>Show Rack Filters used by an application:</p>

<p><code>
$ rake middleware
</code></p>

<h4 id="request-flow">Request Flow</h4>

<h5 id="dispatching">Dispatching</h5>

<p>The <code>routes.rb</code> file generates a <code>ActionDispatch::Routing::RouteSet</code> via the call to <code>Example::Application.routes.draw do</code>. The RouteSet is used to find a matching route and determine its <em>Rack Endpoint</em>. If the endpoint is a controller action, the associated dispatcher then invokes this action. All Controller actions are <em>Rack Endpoints</em>, but the endpoint could also be another Rack app, a redirect macro, or a lambda.</p>

<p>To manually invoke a dispatcher:</p>

<p><code>
&gt;&gt; env = {}
&gt;&gt; env['REQUEST_METHOD'] = 'GET'
&gt;&gt; env['PATH_INFO'] = '/example/index'
&gt;&gt; env['rack.input'] = StringIO.new
ActionController::Dispatcher.new.call(env).last.body # For the response body
</code></p>

<p>A controller's implementation of an action allows for custom handling, however, if no implementation for the action exists or the implementation is empty, it is assumed a view exists, so Rails looks for the view to render. If an action is missing, empty or no rendering is specified, Rails will do the equivalent of:</p>

<p><code>
render "example/index"
</code></p>

<h5 id="rendering">Rendering</h5>

<p>Rendering is the last piece of the request flow.</p>

<p>A controller action can render the template for a different action (for example an <code>update</code> action can render an <code>edit</code> action template if a form fails to validate):</p>

<p><code>
def update
 render action: :update
end
</code></p>

<p>This will render the <code>update</code> template, but will not call the <code>update</code> action, so whatever the template needs must be made available to it.</p>

<p>To render an explicit template:</p>

<p><code>
render template: '/example/update.html.erb'
</code></p>

<p>To render JSON (assuming whatever is passed has a <code>to_json</code> method):</p>

<p><code>
render json: @example
</code></p>

<p>or with a JSONP callback:</p>

<p><code>
render json: @example, callback: "example_callback"
</code></p>

<p>To render nothing:</p>

<p><code>
render :nothing =&gt; true, :status =&gt; 401
</code></p>

<h6 id="other-options">Other options</h6>

<p>Mime type: <code>:contentâ€”type</code>
Layout: <code>:layout</code>
Status: <code>:status</code></p>

<h5 id="redirecting">Redirecting</h5>

<p>Redirecting breaks the flow of the current request flow and initiates another one.</p>

<p>Redirect using controller action:</p>

<p><code>
redirect_to action: show, id: 4
</code></p>

<p>Or using a model (in which case <code>url_for</code> is called on it)</p>

<p><code>
redirect_to @example
</code></p>

<p>Or a URL (hardcoded or in the form of a URL helper).</p>

<p>Or <code>:back</code> which will return to the page that issued the request (the request's <code>HTTP_REFERER</code>) :</p>

<p><code>
redirect_to :back
</code></p>

<p>A flash message can also be passed (using <code>status:</code>, <code>alert:</code> or a hash value for <code>flash:</code>:</p>

<p><code>
redirect_to example_url(@example), alert: "Nope"
</code></p>

<p>An action will continue executing after a redirect, and will end up rendering a view, causing a <code>DoubleRenderError</code> </p>

<h4 id="filters">Filters</h4>

<p>Filters are declared at the top of a controller, and are run in the order they are declared. They can be declared together:</p>

<p><code>
before_filter :foo, :bar
</code></p>

<p>Or separately:</p>

<p>```
before_filter :foo
before_filter :bar</p>

<p>```</p>

<p>A filter is usually a method, but could also be a class which is scoped to the controller with full access to its methods:</p>

<p>```
class ExampleFilter
  def self.after(controller)
    # Do something
  end
end</p>

<p>class ExampleController &lt; ActionController::Base
  after_filter ExampleFilter
end
```</p>

<p>A filter can also take the form of a block, executed in the context of the controller:</p>

<p><code>
before_filter do
   # Do something
end
</code></p>

<p>Filters can also be prepended using: <code>prepend_before_filter</code> and <code>prepend_after_filter</code>, or wrapped around an action using <code>around_filter</code>.</p>

<p>To skip a filter defined on a superclass:</p>

<p><code>
skip_before_filter :example_filter
</code></p>

<p>Filters can be made action-specific using:</p>

<p><code>
before_filter :example_filter, :only =&gt; [:edit, :delete]
</code></p>

<p>Calling <code>render</code> or <code>redirect_to</code> from a filter will halt execution of all other filters.</p>

<h5 id="send-data">Send Data</h5>

<p>Textual or binary data can be sent to the client in a buffer and set either to be downloaded or to be displayed inline using <code>send_data</code>.</p>

<h5 id="send-file">Send File</h5>

<p><code>send_file</code> is similar to <code>send_data</code>, but rather than using data, it references a pre-existing file and hands off the writing of the file to the server, rather than Rails taking care of it itself. </p>


                </div>
                <div class="secondary">
                    <ul class="wiki-menu">
  
        <li>
          <a href="/wiki/angular_js/"></a>
        </li>
  
        <li>
          <a href="/wiki/aspect_ratios/"></a>
        </li>
  
        <li>
          <a href="/wiki/asset_sync/"></a>
        </li>
  
        <li>
          <a href="/wiki/boxen/"></a>
        </li>
  
        <li>
          <a href="/wiki/browser/"></a>
        </li>
  
        <li>
          <a href="/wiki/css/"></a>
        </li>
  
        <li>
          <a href="/wiki/deployment/"></a>
        </li>
  
        <li>
          <a href="/wiki/devise/"></a>
        </li>
  
        <li>
          <a href="/wiki/ember_js/"></a>
        </li>
  
        <li>
          <a href="/wiki/git/"></a>
        </li>
  
        <li>
          <a href="/wiki/google_analytics/"></a>
        </li>
  
        <li>
          <a href="/wiki/handlebars_js/"></a>
        </li>
  
        <li>
          <a href="/wiki/heroku/"></a>
        </li>
  
        <li>
          <a href="/wiki/html/"></a>
        </li>
  
        <li>
          <a href="/wiki/irb/"></a>
        </li>
  
        <li>
          <a href="/wiki/js/"></a>
        </li>
  
        <li>
          <a href="/wiki/logging/"></a>
        </li>
  
        <li>
          <a href="/wiki/middleman/"></a>
        </li>
  
        <li>
          <a href="/wiki/postgresql/"></a>
        </li>
  
        <li>
          <a href="/wiki/pow/"></a>
        </li>
  
        <li>
          <a href="/wiki/project_estimating/"></a>
        </li>
  
        <li>
          <a href="/wiki/project_management/"></a>
        </li>
  
        <li>
          <a href="/wiki/rails/"></a>
        </li>
  
        <li>
          <a href="/wiki/rake/"></a>
        </li>
  
        <li>
          <a href="/wiki/ruby/"></a>
        </li>
  
        <li>
          <a href="/wiki/ruby_gems/"></a>
        </li>
  
        <li>
          <a href="/wiki/ruby_snippets/"></a>
        </li>
  
        <li>
          <a href="/wiki/sass/"></a>
        </li>
  
        <li>
          <a href="/wiki/sidekiq/"></a>
        </li>
  
        <li>
          <a href="/wiki/sinatra/"></a>
        </li>
  
        <li>
          <a href="/wiki/sql/"></a>
        </li>
  
        <li>
          <a href="/wiki/sublime_text/"></a>
        </li>
  
        <li>
          <a href="/wiki/unix/"></a>
        </li>
  
</ul>

                </div>
            </div>
            <footer class="page-footer">
                <p>Gently sculpted from lint by Simon's mum.</p>
            </footer>
        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.8.0.min.js"><\/script>')</script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
